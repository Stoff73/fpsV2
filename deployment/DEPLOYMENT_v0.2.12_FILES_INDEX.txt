================================================================================
TenGo v0.2.12 - Complete Files Index
================================================================================

Version: v0.2.12
Date: November 22, 2025
Total Files Modified: 41 files (15 backend + 26 frontend)
Source: friFixes21Nov.md (ALL 34 sections)

================================================================================
BACKEND FILES (15 files)
================================================================================

CONTROLLERS (7 files)
------------------------------------------------------------
1. app/Http/Controllers/Api/AuthController.php
   Sections: 1, 2
   Changes:
   - Removed token logging from registration (SECURITY - HIGH)
   - Updated password regex to accept all special characters (SECURITY - MEDIUM)
   Lines Changed: ~15

2. app/Http/Controllers/Api/Estate/TrustController.php
   Sections: 4
   Changes:
   - Added getUpcomingTaxReturns method (moved from WillController)
   Lines Changed: ~20

3. app/Http/Controllers/Api/FamilyMembersController.php
   Sections: 27, 28
   Changes:
   - Copy address from current user when creating/linking spouse
   - Create reciprocal family member records for spouse
   Lines Changed: ~50

4. app/Http/Controllers/Api/InvestmentController.php
   Sections: 23, 25
   Changes:
   - Added joint_owner_id to query (later reverted)
   - Final: Uses where('user_id', $user->id) only
   Lines Changed: ~10

5. app/Http/Controllers/Api/MortgageController.php
   Sections: 24
   Changes:
   - Updated all joint ownership checks to include 'tenants_in_common'
   - Balance split and reciprocal creation for both joint types
   Lines Changed: ~30

6. app/Http/Controllers/Api/PropertyController.php
   Sections: 24
   Changes:
   - Updated all joint ownership checks to include 'tenants_in_common'
   - 50/50 split, reciprocal creation, mortgage joint owner fields
   Lines Changed: ~40

7. app/Http/Controllers/Api/UserProfileController.php
   Sections: 30
   Changes:
   - Added ownership_filter query parameter to getFinancialCommitments
   - Filters: 'all', 'joint_only', 'individual_only'
   Lines Changed: ~10

MODELS (3 files)
------------------------------------------------------------
8. app/Models/User.php
   Sections: 5, 7
   Changes:
   - Fixed N+1 query in hasAcceptedSpousePermission() (use relationship)
   - Switched from $fillable to $guarded approach
   Lines Changed: ~80

9. app/Models/Estate/Liability.php
   Sections: 31, 34.1, 34.3
   Changes:
   - Added ownership_type, joint_owner_id, trust_id to fillable
   - Added jointOwner() relationship method
   - Added trust() relationship method
   Lines Changed: ~30

10. app/Models/Investment/InvestmentAccount.php
    Sections: 23
    Changes:
    - Added joint_owner_id to fillable array
    Lines Changed: ~5

SERVICES (2 files)
------------------------------------------------------------
11. app/Services/Onboarding/OnboardingService.php
    Sections: 29, 34.2
    Changes:
    - Added getStepDataFromUser() fallback method for expenditure
    - Added defensive null checks for spouse data access
    Lines Changed: ~120

12. app/Services/UserProfile/UserProfileService.php
    Sections: 30, 34.4
    Changes:
    - Added ownership filtering logic to getFinancialCommitments
    - Created shouldIncludeByOwnership() helper method (DRY)
    - Fixed DC Pension logic (always individual ownership)
    Lines Changed: ~80

CONFIGURATION/ROUTES (3 files)
------------------------------------------------------------
13. config/cors.php
    Sections: 3
    Changes:
    - Removed hardcoded localhost URLs
    - CORS origins now read from env vars only (ALLOWED_ORIGINS)
    Lines Changed: ~15

14. routes/api.php
    Sections: 4
    Changes:
    - Fixed trust route to use TrustController instead of WillController
    Lines Changed: ~5

15. database/migrations/2025_11_22_092125_add_joint_ownership_to_liabilities_table.php
    Sections: 31, 34.1
    Changes:
    - Adds ownership_type enum (individual, joint, trust)
    - Adds joint_owner_id foreign key to users
    - Adds trust_id foreign key to trusts
    Lines Changed: NEW FILE (~80 lines)

================================================================================
FRONTEND FILES (26 files)
================================================================================

ESTATE COMPONENTS (3 files)
------------------------------------------------------------
16. resources/js/components/Estate/GiftingStrategy.vue
    Sections: 21
    Changes:
    - Fixed taper relief timeline colors (green for passed, red for remaining)
    - Was white on grey (unreadable)
    Lines Changed: ~10

17. resources/js/components/Estate/IHTMitigationStrategies.vue
    Sections: 33.1
    Changes:
    - Added amber warning notice to Will strategy card
    - Notice: "Full will functionality has not been implemented"
    Lines Changed: ~15

18. resources/js/components/Estate/IHTPlanning.vue
    Sections: 33.2
    Changes:
    - Added methodology note to Projected column header
    - Shows "4.7% growth rate" explanation
    Lines Changed: ~8

INVESTMENT COMPONENTS (1 file)
------------------------------------------------------------
19. resources/js/components/Investment/PortfolioOverview.vue
    Sections: 22, 32, 34.5, 34.6, 34.7
    Changes:
    - Added ISA contribution tracking (current year, remaining allowance)
    - Fixed joint investment display (full value = share × 2, not share ÷ 2)
    - Improved comments explaining storage pattern
    - Imported TAX_CONFIG.ISA_ANNUAL_ALLOWANCE
    - Renamed getReturnColourClass → getReturnColorClass
    Lines Changed: ~60

NET WORTH COMPONENTS (3 files)
------------------------------------------------------------
20. resources/js/components/NetWorth/NetWorthOverview.vue
    Sections: 17
    Changes:
    - Fixed spouse name display (use user?.spouse?.name not user?.spouse_name)
    Lines Changed: ~8

21. resources/js/components/NetWorth/PropertyCard.vue
    Sections: 24
    Changes:
    - Added tenants in common support (green badge, full support)
    - Updated all joint ownership logic to include TIC
    Lines Changed: ~40

22. resources/js/components/NetWorth/Property/PropertyForm.vue
    Sections: 14
    Changes:
    - Removed 'Part and Part' mortgage type from dropdown
    Lines Changed: ~5

ONBOARDING COMPONENTS (2 files)
------------------------------------------------------------
23. resources/js/components/Onboarding/steps/IncomeStep.vue
    Sections: 15, 26
    Changes:
    - Reduced retirement age minimum from 55 to 30
    - Updated help text
    - Pre-populate employment income from user table
    Lines Changed: ~20

24. resources/js/components/Onboarding/steps/PersonalInfoStep.vue
    Sections: 26
    Changes:
    - Pre-populate from user table on mount
    - Fields: DOB, gender, marital status, address, phone, NI number
    Lines Changed: ~50

RETIREMENT COMPONENTS (2 files)
------------------------------------------------------------
25. resources/js/components/Retirement/DCPensionForm.vue
    Sections: 12
    Changes:
    - Removed validation check for provider field (now optional)
    Lines Changed: ~10

26. resources/js/components/Retirement/UnifiedPensionForm.vue
    Sections: 18
    Changes:
    - Include pension type (_pensionType) in save event
    - Enables parent to dispatch correct store action
    Lines Changed: ~10

USER PROFILE COMPONENTS (1 file)
------------------------------------------------------------
27. resources/js/components/UserProfile/ExpenditureOverview.vue
    Sections: 10
    Changes:
    - Added !! to coerce spouse_id to boolean (fixes Vue prop type warning)
    Lines Changed: ~5

COMPOSABLES (1 file)
------------------------------------------------------------
28. resources/js/composables/useDesignMode.js
    Sections: 11
    Changes:
    - Removed localStorage persistence
    - Always defaults to 'normal' mode on page load
    - Slippery mode must be activated each session
    Lines Changed: ~10

CONSTANTS (1 file - NEW)
------------------------------------------------------------
29. resources/js/constants/taxConfig.js
    Sections: 34.6
    Changes:
    - NEW FILE - Centralized UK tax configuration constants
    - Exports: ISA_ANNUAL_ALLOWANCE, LIFETIME_ISA_ALLOWANCE, etc.
    Lines Changed: NEW FILE (~20 lines)

STORE MODULES (1 file)
------------------------------------------------------------
30. resources/js/store/modules/protection.js
    Sections: 16
    Changes:
    - Added getters for individual policy types
    - lifePolicies, criticalIllnessPolicies, incomeProtectionPolicies, disabilityPolicies
    Lines Changed: ~20

VIEWS (2 files)
------------------------------------------------------------
31. resources/js/views/Dashboard.vue
    Sections: 16
    Changes:
    - Mapped protection getters in computed properties
    - Passed policy arrays to ProtectionOverviewCard component
    Lines Changed: ~20

32. resources/js/views/Retirement/RetirementReadiness.vue
    Sections: 18, 19, 20
    Changes:
    - Fixed handlePensionSave() to dispatch correct action based on type
    - Fixed state pension field mappings (forecast_annual, ni_years, pension_age)
    - Fixed DC pension field mappings (monthly_contribution_amount, retirement_age)
    Lines Changed: ~40

================================================================================
DATABASE CHANGES (2 changes)
================================================================================

PRODUCTION SQL (MANUAL - SECTION 13)
------------------------------------------------------------
ALTER TABLE dc_pensions MODIFY COLUMN provider varchar(255) NULL;

Impact: Non-destructive, makes provider nullable
Reason: Frontend/backend made provider optional, database still required it
Verification: DESCRIBE dc_pensions; (provider shows YES in Null column)

MIGRATION (AUTOMATED - SECTIONS 31, 34.1)
------------------------------------------------------------
File: database/migrations/2025_11_22_092125_add_joint_ownership_to_liabilities_table.php

Changes:
- Adds ownership_type ENUM('individual', 'joint', 'trust') DEFAULT 'individual'
- Adds joint_owner_id BIGINT UNSIGNED NULL (FK to users)
- Adds trust_id BIGINT UNSIGNED NULL (FK to trusts)

Impact: Non-destructive, existing records default to 'individual'
Verification: DESCRIBE liabilities; (shows new columns)

================================================================================
ENVIRONMENT CHANGES (REQUIRED)
================================================================================

PRODUCTION .ENV ADDITIONS (SECTION 3)
------------------------------------------------------------
ALLOWED_ORIGINS=https://csjones.co
FRONTEND_URL=https://csjones.co

Reason: CORS configuration no longer hardcodes origins
Impact: Without these, API requests fail with CORS errors

================================================================================
FILES BY SECTION NUMBER
================================================================================

Section 1: AuthController.php (token logging removed)
Section 2: AuthController.php (password regex updated)
Section 3: config/cors.php, .env (CORS origins from env vars)
Section 4: routes/api.php, TrustController.php (trust route fix)
Section 5: User.php (N+1 query fix)
Section 6: User.php (float casts documented)
Section 7: User.php (switched to guarded)
Section 8: routes/api.php (already compliant)
Section 9: routes/api.php (deferred)
Section 10: ExpenditureOverview.vue (Vue prop type fix)
Section 11: useDesignMode.js (slippery mode default)
Section 12: DCPensionForm.vue (provider optional frontend)
Section 13: dc_pensions table (provider nullable database) ⚠️ PRODUCTION SQL
Section 14: PropertyForm.vue (removed mortgage type)
Section 15: IncomeStep.vue (retirement age min 30)
Section 16: protection.js, Dashboard.vue (policy display)
Section 17: NetWorthOverview.vue (spouse name)
Section 18: UnifiedPensionForm.vue, RetirementReadiness.vue (state pension save)
Section 19: RetirementReadiness.vue (state pension fields)
Section 20: RetirementReadiness.vue (DC pension fields)
Section 21: GiftingStrategy.vue (taper relief colors)
Section 22: PortfolioOverview.vue (ISA tracking)
Section 23: InvestmentController.php, InvestmentAccount.php (joint visibility)
Section 24: PropertyCard.vue, PropertyController.php, MortgageController.php (TIC support)
Section 25: InvestmentController.php (duplicate display fix)
Section 26: PersonalInfoStep.vue, IncomeStep.vue (onboarding pre-population)
Section 27: FamilyMembersController.php (address copying)
Section 28: FamilyMembersController.php (reciprocal family members)
Section 29: OnboardingService.php (expenditure pre-population)
Section 30: UserProfileController.php, UserProfileService.php (ownership filtering)
Section 31: Migration, Liability.php (joint ownership liabilities) ⚠️ MIGRATION
Section 32: PortfolioOverview.vue (joint investment display fix)
Section 33.1: IHTMitigationStrategies.vue (will strategy notice)
Section 33.2: IHTPlanning.vue (projection methodology)
Section 34.1: Migration, Liability.php (trust ownership)
Section 34.2: OnboardingService.php (null safety)
Section 34.3: Liability.php (Eloquent relationships)
Section 34.4: UserProfileService.php (ownership filter helper)
Section 34.5: PortfolioOverview.vue (improved comments)
Section 34.6: taxConfig.js (NEW), PortfolioOverview.vue (centralized ISA allowance)
Section 34.7: PortfolioOverview.vue (method naming)

================================================================================
FILES BY PRIORITY
================================================================================

CRITICAL (MUST UPLOAD)
------------------------------------------------------------
- config/cors.php (Section 3 - CORS security)
- AuthController.php (Sections 1, 2 - Security fixes)
- Migration file (Sections 31, 34.1 - Database schema)
- DCPensionForm.vue (Section 12 - Critical bug fix)
- RetirementReadiness.vue (Sections 18, 19, 20 - Critical bug fix)
- UnifiedPensionForm.vue (Section 18 - Critical bug fix)
- PortfolioOverview.vue (Section 32 - Calculation error)

HIGH PRIORITY
------------------------------------------------------------
- PropertyCard.vue, PropertyController.php, MortgageController.php (Section 24 - Feature gap)
- Liability.php (Sections 31, 34.1, 34.3 - FPS standards)
- OnboardingService.php (Sections 29, 34.2 - UX + null safety)
- FamilyMembersController.php (Sections 27, 28 - UX improvement)
- UserProfileService.php (Sections 30, 34.4 - Filtering + refactoring)

MEDIUM PRIORITY
------------------------------------------------------------
- All remaining Vue components (UI improvements)
- User.php (Sections 5, 7 - Performance + maintainability)
- TrustController.php (Section 4 - Domain separation)
- protection.js, Dashboard.vue (Section 16 - Dashboard fix)

LOW PRIORITY
------------------------------------------------------------
- GiftingStrategy.vue (Section 21 - Color readability)
- IHTMitigationStrategies.vue, IHTPlanning.vue (Section 33 - UI notices)
- taxConfig.js (Section 34.6 - Constants file)

================================================================================
VERIFICATION CHECKLIST
================================================================================

Backend Files Uploaded (15 files):
[ ] AuthController.php
[ ] TrustController.php
[ ] FamilyMembersController.php
[ ] InvestmentController.php
[ ] MortgageController.php
[ ] PropertyController.php
[ ] UserProfileController.php
[ ] User.php
[ ] Liability.php
[ ] InvestmentAccount.php
[ ] OnboardingService.php
[ ] UserProfileService.php
[ ] cors.php
[ ] api.php
[ ] 2025_11_22_092125_add_joint_ownership_to_liabilities_table.php

Frontend Files Uploaded (26 files):
[ ] GiftingStrategy.vue
[ ] IHTMitigationStrategies.vue
[ ] IHTPlanning.vue
[ ] PortfolioOverview.vue
[ ] NetWorthOverview.vue
[ ] PropertyCard.vue
[ ] PropertyForm.vue
[ ] IncomeStep.vue
[ ] PersonalInfoStep.vue
[ ] DCPensionForm.vue
[ ] UnifiedPensionForm.vue
[ ] ExpenditureOverview.vue
[ ] useDesignMode.js
[ ] taxConfig.js (NEW FILE)
[ ] protection.js
[ ] Dashboard.vue
[ ] RetirementReadiness.vue

Database Changes:
[ ] Production SQL executed (dc_pensions.provider nullable)
[ ] Migration executed (liabilities ownership columns)
[ ] Verification script passed (all PASS)

Environment Changes:
[ ] ALLOWED_ORIGINS added to .env
[ ] FRONTEND_URL added to .env

================================================================================
END OF FILES INDEX
================================================================================

Generated: November 22, 2025
Version: v0.2.12
Total Files: 41 (15 backend + 26 frontend)
Total Sections: 34 (all sections from friFixes21Nov.md)

Built with Claude Code
